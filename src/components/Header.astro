---
import { Icon } from 'astro-icon/components';

interface Props { currentPath?: string }
const { currentPath = '/' } = Astro.props as Props;

const navItems = [
    { label: 'Catálogo', href: '/' },
    { label: 'Nosotros', href: '/nosotros' },
    { label: 'Servicios', href: '/servicios' },
    { label: 'Contacto', href: '/contacto' },
];

const isActive = (href: string) => currentPath === href || currentPath.startsWith(href + '/');
---

<header id="header">
    <div class="container">
        <div class="logo">
            <a href="/">
                <h1>Transmisiones SV</h1>
                <p>Confianza y Rendimiento</p>
            </a>
        </div>
        
        <nav class="desktop-nav">
            {navItems.map(item => (
                <a 
                    href={item.href} 
                    class={`nav-link ${isActive(item.href) ? 'active' : ''}`}
                    aria-current={isActive(item.href) ? 'page' : undefined}
                >
                    {item.label}
                    <span class="nav-indicator"></span>
                </a>
            ))}
        </nav>

        <button id="mobileToggle" class="mobile-menu-toggle" aria-label="Abrir menú" aria-controls="mobile-dropdown" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>

    <!-- Mobile dropdown panel -->
    <div id="mobile-dropdown" class="mobile-dropdown" aria-hidden="true">
        <div class="dropdown-panel glass">
            {navItems.map(item => (
                <a 
                    href={item.href} 
                    class={`mobile-nav-link ${isActive(item.href) ? 'active' : ''}`}
                    aria-current={isActive(item.href) ? 'page' : undefined}
                    role="menuitem"
                >
                    {item.label}
                </a>
            ))}
            <div class="mobile-cta">
                <a class="btn" href="/#catalogo">Ver Catálogo</a>
                <a class="btn outline" href="/contacto">Solicitar Cotización</a>
            </div>
        </div>
    </div>

    <script>
    (function(){
        const toggle = document.getElementById('mobileToggle') as HTMLElement | null;
        const dropdown = document.getElementById('mobile-dropdown') as HTMLElement | null;
        const header = document.getElementById('header') as HTMLElement | null;
        const links = dropdown?.querySelectorAll('.mobile-nav-link') || [];

        let isOpen = false;

        function openMenu(){
            if (!dropdown || !toggle) return;
            dropdown.classList.add('active');
            dropdown.setAttribute('aria-hidden', 'false');
            toggle.setAttribute('aria-expanded','true');
            toggle.classList.add('active');
            isOpen = true;
        }
        function closeMenu(){
            if (!dropdown || !toggle) return;
            dropdown.classList.remove('active');
            dropdown.setAttribute('aria-hidden', 'true');
            toggle.setAttribute('aria-expanded','false');
            toggle.classList.remove('active');
            isOpen = false;
        }

        toggle?.addEventListener('click', () => { isOpen ? closeMenu() : openMenu(); });
        links.forEach(l => l.addEventListener('click', closeMenu));
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
        document.addEventListener('click', (e) => {
            if (!isOpen) return;
            const target = e.target as Node;
            if (header && !header.contains(target)) closeMenu();
        });
        window.addEventListener('resize', () => { if (window.innerWidth > 768) closeMenu(); });

    // header remains static: no visual changes on scroll
    })();
    </script>
</header>

<style>
    /* ===== HEADER PREMIUM STYLE ===== */
    header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        height: 72px;
        background: linear-gradient(135deg, 
            rgba(10,14,20,0.5) 0%, 
            rgba(15,20,25,0.45) 100%);
        backdrop-filter: blur(28px) saturate(1.4);
        -webkit-backdrop-filter: blur(28px) saturate(1.4);
        border-bottom: 1px solid var(--glass-border);
    transition: none; /* sin transición para permanecer estática */
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    transform: none; /* sin transform para evitar saltos */
    }

    header::after {
        /* sutil textura para reforzar el efecto glass */
        content: '';
        position: absolute;
        inset: 0;
        background-image: url('/assets/noise-2.svg');
        opacity: 0.06;
        pointer-events: none;
        mix-blend-mode: overlay;
    }

    header.scrolled {
        /* estilos neutralizados para permanecer estático */
        padding: var(--spacing-md) 0;
        background: linear-gradient(135deg, 
            rgba(10,14,20,0.5) 0%, 
            rgba(15,20,25,0.45) 100%);
        backdrop-filter: blur(28px) saturate(1.4);
        -webkit-backdrop-filter: blur(28px) saturate(1.4);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border-bottom: 1px solid var(--glass-border);
        animation: none;
    }

    .container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 var(--spacing-md);
        height: 100%;
    }

    /* ===== LOGO PREMIUM ===== */
    .logo a {
        text-decoration: none;
        color: inherit;
        display: block;
        position: relative;
        padding: var(--spacing-sm);
        border-radius: var(--radius-md);
        transition: all var(--motion-medium) var(--ease-out);
        overflow: hidden;
    }

    .logo a::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity var(--motion-medium) var(--ease-out);
        border-radius: var(--radius-md);
        z-index: -1;
    }

    .logo a:hover::before {
        opacity: 0.1;
    }

    .logo h1 {
        font-family: 'Orbitron', sans-serif;
        font-size: clamp(1.2rem, 2.5vw, 1.6rem);
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
        line-height: 1.1;
        letter-spacing: -0.02em;
        text-shadow: 0 0 20px rgba(255,107,26,0.3);
        transition: all var(--motion-medium) var(--ease-out);
    }

    .logo p {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin: 2px 0 0 0;
        font-weight: 500;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        opacity: 0.8;
        transition: all var(--motion-medium) var(--ease-out);
    }

    .logo a:hover h1 {
        text-shadow: var(--glow-primary);
        transform: scale(1.02);
    }

    .logo a:hover p {
        color: var(--primary-light);
        opacity: 1;
    }

    /* ===== NAVEGACIÓN DESKTOP PREMIUM ===== */
    .desktop-nav {
        display: flex;
        gap: var(--spacing-xl);
        align-items: center;
    }

    .nav-link {
        position: relative;
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius-md);
        transition: all var(--motion-medium) var(--ease-out);
        overflow: hidden;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    .nav-link::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, 
            var(--glass-medium), 
            var(--glass-light));
        opacity: 0;
        transition: opacity var(--motion-medium) var(--ease-out);
        border-radius: var(--radius-md);
        z-index: -1;
    }

    .nav-link:hover {
        color: var(--text-primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md), var(--glow-primary);
    }

    .nav-link:hover::before {
        opacity: 1;
    }

    .nav-indicator {
        position: absolute;
        bottom: -2px;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--gradient-primary);
        border-radius: 1px;
        transition: all var(--motion-medium) var(--ease-out);
        transform: translateX(-50%);
        box-shadow: var(--glow-primary);
    }

    .nav-link:hover .nav-indicator {
        width: 80%;
    }

    .nav-link.active {
        color: var(--primary);
        background: linear-gradient(135deg, 
            var(--glass-medium), 
            var(--glass-light));
        box-shadow: var(--shadow-sm), var(--glow-primary);
    }

    .nav-link.active .nav-indicator {
        width: 80%;
    }

    /* ===== MOBILE MENU TOGGLE PREMIUM ===== */
    .mobile-menu-toggle {
        display: none;
        flex-direction: column;
        justify-content: space-between;
        width: 24px;
        height: 18px;
        background: none;
        border: none;
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        transition: all var(--motion-medium) var(--ease-out);
        position: relative;
        overflow: hidden;
    }

    .mobile-menu-toggle::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity var(--motion-medium) var(--ease-out);
        border-radius: var(--radius-sm);
        z-index: -1;
    }

    .mobile-menu-toggle:hover::before {
        opacity: 0.1;
    }

    .mobile-menu-toggle span {
        display: block;
        height: 2px;
        width: 100%;
        background: var(--text-primary);
        border-radius: 1px;
        transition: all var(--motion-medium) var(--ease-out);
        transform-origin: center;
        box-shadow: 0 0 4px rgba(255,107,26,0.3);
    }

    .mobile-menu-toggle:hover span {
        background: var(--primary);
        box-shadow: var(--glow-primary);
    }

    .mobile-menu-toggle.active span:first-child {
        transform: rotate(45deg) translate(6px, 6px);
    }

    .mobile-menu-toggle.active span:nth-child(2) {
        opacity: 0;
        transform: scale(0);
    }

    .mobile-menu-toggle.active span:last-child {
        transform: rotate(-45deg) translate(6px, -6px);
    }

    /* ===== MOBILE DROPDOWN PREMIUM ===== */
    .mobile-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        padding: 0 var(--spacing-md);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-8px);
        transition: all var(--motion-medium) var(--ease-out);
    }

    .mobile-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .dropdown-panel {
        padding: var(--spacing-xl);
        border-radius: var(--radius-xl);
        background: rgba(10,14,20,0.9); /* más opaco para legibilidad */
        backdrop-filter: blur(10px) saturate(1.1);
        -webkit-backdrop-filter: blur(10px) saturate(1.1);
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-xl); /* sin glow para no deslumbrar */
        text-align: center;
        max-height: calc(100dvh - 90px);
        overflow-y: auto;
    }

    .mobile-nav-link {
        display: block;
        color: var(--text-primary);
        text-decoration: none;
        font-size: 1.2rem;
        font-weight: 600;
        padding: var(--spacing-lg);
        margin: var(--spacing-sm) 0;
        border-radius: var(--radius-lg);
        transition: all var(--motion-medium) var(--ease-out);
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .mobile-nav-link::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity var(--motion-medium) var(--ease-out);
        border-radius: var(--radius-lg);
        z-index: -1;
    }

    .mobile-nav-link:hover {
        color: var(--text-primary);
        transform: translateX(8px) scale(1.02);
        text-shadow: var(--glow-primary);
    }

    .mobile-nav-link:hover::before {
        opacity: 0.15;
    }

    .mobile-cta {
        margin-top: var(--spacing-2xl);
        padding-top: var(--spacing-xl);
        border-top: 1px solid var(--glass-border);
    }

    .mobile-cta .btn {
        width: 100%;
        font-size: 1rem;
        padding: var(--spacing-lg);
        box-shadow: var(--shadow-lg), var(--glow-primary);
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
        header { height: 64px; }
        .desktop-nav {
            display: none;
        }

        .mobile-menu-toggle {
            display: flex;
        }

        .container {
            padding: 0 var(--spacing-sm);
        }

        .logo h1 {
            font-size: 1.3rem;
        }

        .logo p {
            font-size: 0.7rem;
        }
        .dropdown-panel { padding: var(--spacing-xl); }

        /* Reducir glow en móviles para máxima legibilidad */
        header {
            background: linear-gradient(135deg,
                rgba(10,14,20,0.65) 0%,
                rgba(15,20,25,0.6) 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.12);
            backdrop-filter: blur(22px) saturate(1.2);
            -webkit-backdrop-filter: blur(22px) saturate(1.2);
        }
        header::after { opacity: 0.03; }
        .logo h1 { text-shadow: none; }
        .mobile-menu-toggle span { box-shadow: none; }
        .mobile-nav-link:hover {
            text-shadow: none;
            transform: translateX(6px) scale(1.01);
        }
        .mobile-cta .btn { box-shadow: var(--shadow-sm); }

        /* Mínimo glass en el dropdown para lectura clara */
        .dropdown-panel {
            background: rgba(10,14,20,0.92);
            backdrop-filter: blur(8px) saturate(1.05);
            -webkit-backdrop-filter: blur(8px) saturate(1.05);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        .mobile-nav-link {
            color: #fff;
        }
        .mobile-nav-link::before { opacity: 0; }
        .mobile-nav-link:hover { background: rgba(255,255,255,0.06); }
        .mobile-nav-link.active {
            background: rgba(255,255,255,0.08);
            color: var(--primary);
            box-shadow: none;
        }
    }

    @media (max-width: 480px) {
        .mobile-nav-link {
            font-size: 1.1rem;
            padding: var(--spacing-md);
        }
        .dropdown-panel { padding: var(--spacing-lg); }
    }

    /* ===== ANIMACIONES ESPECIALES ===== */
    @keyframes headerGlow {
        0%, 100% { 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2); 
        }
        50% { 
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.2),
                0 0 20px rgba(255,107,26,0.1); 
        }
    }

    header.scrolled { animation: none; }

    /* ===== ACCESIBILIDAD MEJORADA ===== */
    @media (prefers-reduced-motion: reduce) {
        header,
        .nav-link,
        .mobile-menu,
        .mobile-links,
        .mobile-nav-link {
            transition: none;
        }

        header.scrolled {
            animation: none;
        }
    }

    /* ===== FOCUS STATES PREMIUM ===== */
    .nav-link:focus-visible,
    .mobile-nav-link:focus-visible,
    .mobile-close:focus-visible,
    .mobile-menu-toggle:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
        background: var(--glass-medium);
        box-shadow: var(--shadow-md), var(--glow-primary);
    }

    .logo a:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 4px;
        border-radius: var(--radius-md);
    }

    /* Active states */
    .mobile-nav-link.active {
        background: linear-gradient(135deg, var(--glass-medium), var(--glass-light));
        box-shadow: var(--shadow-sm), var(--glow-primary);
        color: var(--primary);
    }
</style>